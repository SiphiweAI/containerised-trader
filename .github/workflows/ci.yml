name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

env:
  API_KEY: ${{ secrets.API_KEY }}
  DB_HOST: ${{ secrets.DB_HOST }}
  DB_NAME: ${{ secrets.DB_NAME }}
  DB_USER: ${{ secrets.DB_USER }}
  DB_PASSWORD: ${{ secrets.DB_PASSWORD }}
  CELERY_BROKER_URL: ${{ secrets.CELERY_BROKER_URL }}

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: 3.11

    - name: Install dependencies
      run: pip install -r requirements.txt

    - name: Run tests
      run: pytest

    - name: Check secrets
      run: |
        if [ -z "$API_KEY" ] || [ -z "$DB_HOST" ] || [ -z "$DB_NAME" ] || [ -z "$DB_USER" ] || [ -z "$DB_PASSWORD" ] || [ -z "$CELERY_BROKER_URL" ]; then
          echo "One or more secrets are missing!"
          exit 1
        fi

